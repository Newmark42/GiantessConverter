<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTS Converter - Visual Edition</title>
    <style>
        :root {
            --primary-color: #e91e63;
            --secondary-color: #fce4ec;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 15px 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .left-col .card {
            padding: 15px 20px;
            margin-bottom: 15px;
        }

        h1, h2, h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .left-col h2 {
            margin-bottom: 10px;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            margin-top: 10px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .left-col .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="number"], select {
            width: 100%;
            max-width: 120px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 13px;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row > div {
            flex: 1;
        }

        .visual-container {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 700px;
            background: #e0f7fa;
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
            overflow: hidden;
            border-bottom: 4px solid #81d4fa;
        }

        .visual-box {
            text-align: center;
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        .visual-label {
            margin-top: 10px;
            font-weight: bold;
            background: rgba(255,255,255,0.8);
            padding: 4px 8px;
            border-radius: 4px;
        }

        /* SVG Styles */
        .silhouette {
            fill: var(--primary-color);
            transition: all 0.5s ease;
        }
        
        .reference-obj {
            fill: #555;
            transition: all 0.5s ease;
        }

        .ruler-mark {
            stroke: #333;
            stroke-width: 2;
        }
        
        /* Image positioning and blend effects */
        #giantessWoman {
            transition: all 0.5s ease;
        }
        
        #startPerson {
            transition: all 0.5s ease;
        }
        
        #buildingRef {
            transition: all 0.5s ease;
        }
        
        /* SVG ruler - normal appearance, no blend effects */
        #rulerSvg {
            /* Normal black ruler */
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: var(--secondary-color);
            padding: 10px;
            border-radius: 8px;
        }

        .result-label {
            font-size: 0.9em;
            color: #666;
        }

        .result-value {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Smaller font for bottom stats section */
        .card[style*="padding: 10px 20px"] .result-value {
            font-size: 0.8em;
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Range slider for height */
        input[type=range] {
            width: 100%;
        }

        /* Range buttons */
        .range-buttons {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .range-btn {
            flex: 1;
            padding: 8px 4px;
            border: 2px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.2s;
        }

        .range-btn:hover {
            background: var(--secondary-color);
        }

        .range-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* Accordion/Collapsible Sections */
        .accordion-section {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .accordion-header {
            background: var(--secondary-color);
            padding: 12px 15px;
            cursor: pointer;
            user-select: none;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s;
        }

        .accordion-header:hover {
            background-color: #f8bbd9;
        }

        .accordion-header.active {
            background: var(--primary-color);
            color: white;
        }

        .accordion-chevron {
            transition: transform 0.2s;
            font-size: 0.8em;
        }

        .accordion-header.active .accordion-chevron {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: white;
        }

        .accordion-content.active {
            max-height: 500px;
            transition: max-height 0.3s ease-in;
        }

        .accordion-body {
            padding: 10px;
        }

    </style>
</head>
<body>

    <h1>GTS Converter 2025</h1>

    <div class="container">
        <!-- Left Column: Inputs -->
        <div class="left-col">
            <div class="range-buttons" style="margin-bottom: 15px;">
                <button class="range-btn active" onclick="switchInputUnit('standard', this)">Standard</button>
                <button class="range-btn" onclick="switchInputUnit('metric', this)">Metric</button>
            </div>

            <!-- Standard Inputs -->
            <div id="standard-inputs" class="tab-content active">
                <div class="card">
                    <h2>Before Size</h2>
                    <div class="row">
                        <div class="input-group">
                            <label>Feet</label>
                            <input type="number" id="wmnfeet" value="5">
                        </div>
                        <div class="input-group">
                            <label>Inches</label>
                            <input type="number" id="wmninches" value="6">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Weight (lbs)</label>
                        <input type="number" id="wmnweight" value="100">
                    </div>
                    <div class="row">
                        <div class="input-group">
                            <label>Cup Size</label>
                            <select id="cup">
                                <option value="0.8">A</option>
                                <option value="1.6">B</option>
                                <option value="2.35" selected>C</option>
                                <option value="3.05">D</option>
                                <option value="3.75">DD</option>
                                <option value="4.4">DDD</option>
                                <option value="5.05">G</option>
                                <option value="5.65">H</option>
                                <option value="6.25">I</option>
                                <option value="6.8">J</option>
                                <option value="7.4">K</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Shoe (US)</label>
                            <select id="shoe">
                                <option value="8">3</option>
                                <option value="8.69">5</option>
                                <option value="9">6</option>
                                <option value="9.31">7</option>
                                <option value="9.69" selected>8</option>
                                <option value="10">9</option>
                                <option value="10.31">10</option>
                                <option value="11">12</option>
                                <option value="12">15</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-group">
                            <label>Bust (in)</label>
                            <input type="number" id="key1" value="36">
                        </div>
                        <div class="input-group">
                            <label>Waist (in)</label>
                            <input type="number" id="key2" value="24">
                        </div>
                        <div class="input-group">
                            <label>Hips (in)</label>
                            <input type="number" id="key3" value="36">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Lift Capacity (lbs)</label>
                        <input type="number" id="gtslift" value="50">
                    </div>
                </div>

                <div class="card">
                    <h2>Target Size</h2>
                    <div class="row">
                        <div class="input-group">
                            <label>Miles</label>
                            <input type="number" id="gtsmiles" value="0">
                        </div>
                        <div class="input-group">
                            <label>Feet</label>
                            <input type="number" id="gtsfeet" value="50">
                        </div>
                        <div class="input-group">
                            <label>Inches</label>
                            <input type="number" id="gtsinches" value="0">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quick Scale Slider (approx)</label>
                        <input type="range" id="heightSlider" min="7.5" max="500" value="50" step="0.5">
                        <div class="range-buttons">
                            <button class="range-btn" onclick="setRange('mini', this)">MiniGTS</button>
                            <button class="range-btn active" onclick="setRange('gts', this)">GTS</button>
                            <button class="range-btn" onclick="setRange('mega', this)">Mega</button>
                            <button class="range-btn" onclick="setRange('giga', this)">Giga</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Metric Inputs -->
            <div id="metric-inputs" class="tab-content">
                <div class="card">
                    <h2>Before Size</h2>
                    <div class="row">
                        <div class="input-group">
                            <label>m</label>
                            <input type="number" id="wmnmeters" value="1.68" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>cm</label>
                            <input type="number" id="wmncm" value="0">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Weight (kg)</label>
                        <input type="number" id="wmnkg" value="45" step="0.1">
                    </div>
                    <div class="row">
                        <div class="input-group">
                            <label>Cup Size</label>
                            <select id="cupMetric">
                                <option value="0.8">A</option>
                                <option value="1.6">B</option>
                                <option value="2.35" selected>C</option>
                                <option value="3.05">D</option>
                                <option value="3.75">E (UK DD)</option>
                                <option value="4.4">F (UK E)</option>
                                <option value="5.05">G (UK F)</option>
                                <option value="5.65">H (UK FF)</option>
                                <option value="6.25">J (UK G)</option>
                                <option value="6.8">K (UK GG)</option>
                                <option value="7.4">L (UK H)</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Shoe (EU)</label>
                            <select id="shoeMetric">
                                <option value="8">35</option>
                                <option value="8.69">37</option>
                                <option value="9">38</option>
                                <option value="9.31">39</option>
                                <option value="9.69" selected>40</option>
                                <option value="10">41</option>
                                <option value="10.31">42</option>
                                <option value="11">44</option>
                                <option value="12">47</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-group">
                            <label>Bust (cm)</label>
                            <input type="number" id="key1Metric" value="91" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Waist (cm)</label>
                            <input type="number" id="key2Metric" value="61" step="0.1">
                        </div>
                        <div class="input-group">
                            <label>Hips (cm)</label>
                            <input type="number" id="key3Metric" value="91" step="0.1">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Lift Capacity (kg)</label>
                        <input type="number" id="gtsliftMetric" value="23" step="0.1">
                    </div>
                </div>

                <div class="card">
                    <h2>Target Size</h2>
                    <div class="row">
                        <div class="input-group">
                            <label>km</label>
                            <input type="number" id="gtskm" value="0" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>m</label>
                            <input type="number" id="gtsmeters" value="15.24" step="0.01">
                        </div>
                        <div class="input-group">
                            <label>cm</label>
                            <input type="number" id="gtscm" value="0">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Quick Scale Slider (approx)</label>
                        <input type="range" id="heightSliderMetric" min="2.3" max="152.4" value="15.24" step="0.1">
                        <div class="range-buttons">
                            <button class="range-btn" onclick="setRangeMetric('mini', this)">MiniGTS</button>
                            <button class="range-btn active" onclick="setRangeMetric('gts', this)">GTS</button>
                            <button class="range-btn" onclick="setRangeMetric('mega', this)">Mega</button>
                            <button class="range-btn" onclick="setRangeMetric('giga', this)">Giga</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Visuals -->
        <div class="right-col">
            <div class="card">
                <h2>Visual Comparison</h2>
                <div class="visual-container">
                    <!-- SVG for ruler only -->
                    <svg id="rulerSvg" viewBox="0 0 400 700" style="position: absolute; left: 0; bottom: 0; width: 400px; height: 700px; pointer-events: none; z-index: 1;">
                        <g id="rulerGroup">
                            <!-- Main vertical line -->
                            <line x1="50" y1="20" x2="50" y2="700" stroke="black" stroke-width="2" />
                            <!-- Ticks and Text generated by JS -->
                        </g>
                    </svg>
                    
                    <!-- Images positioned with CSS - building first for z-index -->
                    <img id="buildingRef" src="200ft-tall-bldg.png" style="position: absolute; bottom: 0; left: 500px; z-index: 1;" />
                    
                    <!-- Anchor div for start person - positioned 160px from left edge -->
                    <div id="startPersonAnchor" style="position: absolute; bottom: 0; left: 160px; width: 1px; height: 1px; overflow: visible; z-index: 10;">
                        <img id="startPerson" src="female-silouette-strong.png" style="position: absolute; right: 0; bottom: 0;" />
                    </div>
                    
                    <img id="giantessWoman" src="female-silouette-strong.png" style="position: absolute; bottom: 0; z-index: 2;" />
                </div>
                <div style="text-align: center; margin-top: 10px; font-style: italic; color: #666;">
                    Comparison: Starting Size vs Giantess Size
                </div>
            </div>
        </div>

        <!-- Measurements Column (Right) - Accordion Sections -->
        <div class="measurements-col">
            <div class="card">
                <!-- Key Heights - Open by default -->
                <div class="accordion-section">
                    <div class="accordion-header active" onclick="toggleAccordion('keyHeights', this)">
                        <span>Key Heights</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content active" id="keyHeights-content">
                        <div class="accordion-body">
                            <div id="keyHeightsContent">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Head Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('head', this)">
                        <span>Head</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="head-content">
                        <div class="accordion-body" id="headContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Breasts Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('breasts', this)">
                        <span>Breasts</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="breasts-content">
                        <div class="accordion-body" id="breastsContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Milk Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('milk', this)">
                        <span>Milk</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="milk-content">
                        <div class="accordion-body" id="milkContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Crotch Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('crotch', this)">
                        <span>Crotch</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="crotch-content">
                        <div class="accordion-body" id="crotchContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Arms & Legs Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('armsLegs', this)">
                        <span>Arms & Legs</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="armsLegs-content">
                        <div class="accordion-body" id="armsLegsContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Movement Section -->
                <div class="accordion-section">
                    <div class="accordion-header" onclick="toggleAccordion('movement', this)">
                        <span>Movement</span>
                        <span class="accordion-chevron">▼</span>
                    </div>
                    <div class="accordion-content" id="movement-content">
                        <div class="accordion-body" id="movementContent">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Stats - Spans full width -->
        <div style="grid-column: 1 / -1;">
            <div class="card" style="padding: 10px 20px;">
                <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <div class="result-item" style="flex: 0 1 220px; min-width: 180px;">
                        <div class="result-label">Weight</div>
                        <div class="result-value" id="resWeight">--</div>
                    </div>
                    <div class="result-item" style="flex: 0 1 220px; min-width: 180px;">
                        <div class="result-label">Measurements (B/W/H)</div>
                        <div class="result-value" id="resMeasurements">--</div>
                    </div>
                    <div class="result-item" style="flex: 0 1 220px; min-width: 180px;">
                        <div class="result-label">Foot Length</div>
                        <div class="result-value" id="resFoot">--</div>
                    </div>
                    <div class="result-item" style="flex: 0 1 220px; min-width: 180px;">
                        <div class="result-label">Walk Speed</div>
                        <div class="result-value" id="resWalkSpeed">--</div>
                    </div>
                    <div class="result-item" style="flex: 0 1 220px; min-width: 180px;">
                        <div class="result-label">Run Speed</div>
                        <div class="result-value" id="resRunSpeed">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reference Measurements Section -->
        <div style="grid-column: 1 / -1;">
            <div class="card">
                <h3>Reference Measurements</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center;">
                    
                    <!-- Living Section -->
                    <div class="reference-section" style="flex: 0 1 auto; min-width: 200px; max-width: 280px;">
                        <h4 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">Living</h4>
                        <div style="font-size: 0.8em; display: grid; grid-template-columns: 1fr 1fr; gap: 5px 8px; line-height: 1.3;">
                            <div style="text-align: right; font-weight: bold;">Tallest Human:</div>
                            <div>9 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Elephant:</div>
                            <div>13 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Giraffe:</div>
                            <div>17 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Blue Whale:</div>
                            <div>90 ft long</div>
                            
                            <div style="text-align: right; font-weight: bold;">Maple Tree:</div>
                            <div>30 to 130 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Pine Tree:</div>
                            <div>50 to 150 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Sequoia Tree:</div>
                            <div>300 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Redwood Tree:</div>
                            <div>350 ft tall</div>
                        </div>
                    </div>
                    
                    <!-- Constructs Section -->
                    <div class="reference-section" style="flex: 0 1 auto; min-width: 240px; max-width: 320px;">
                        <h4 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">Constructs</h4>
                        <div style="font-size: 0.8em; display: grid; grid-template-columns: 1fr 1fr; gap: 5px 8px; line-height: 1.3;">
                            <div style="text-align: right; font-weight: bold;">Statue of Liberty:</div>
                            <div>151 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Clock Tower (Big Ben):</div>
                            <div>316 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Washington Monument:</div>
                            <div>555 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Seattle Space Needle:</div>
                            <div>605 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Eiffel Tower:</div>
                            <div>1,063 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Tokyo Tower:</div>
                            <div>1,091 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">Sears Tower:</div>
                            <div>1,450 ft tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">CN Tower:</div>
                            <div>1,815 ft tall</div>
                        </div>
                    </div>
                    
                    <!-- Common Interaction Section -->
                    <div class="reference-section" style="flex: 0 1 auto; min-width: 250px; max-width: 340px;">
                        <h4 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">Common Interaction</h4>
                        <div style="font-size: 0.8em; display: grid; grid-template-columns: 1fr 1fr; gap: 5px 8px; line-height: 1.3;">
                            <div style="text-align: right; font-weight: bold;">City Bus:</div>
                            <div>50 ft long, 9 tons</div>
                            
                            <div style="text-align: right; font-weight: bold;">Train Car:</div>
                            <div>80 ft long, 25 tons</div>
                            
                            <div style="text-align: right; font-weight: bold;">Boeing 747:</div>
                            <div>231 ft long, 191 tons</div>
                            
                            <div style="text-align: right; font-weight: bold;">Cruise Ship:</div>
                            <div>935 ft long, 83,000 tons</div>
                            
                            <div style="text-align: right; font-weight: bold;">Oil Tanker:</div>
                            <div>1350 ft long, 500,000 tons</div>
                            
                            <div style="text-align: right; font-weight: bold;">Road Width:</div>
                            <div>11 ft / lane, 12 ft highway</div>
                            
                            <div style="text-align: right; font-weight: bold;">Sidewalk:</div>
                            <div>4 to 6 ft on each side</div>
                        </div>
                    </div>
                    
                    <!-- Geological Section -->
                    <div class="reference-section" style="flex: 0 1 auto; min-width: 280px; max-width: 380px;">
                        <h4 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">Geological</h4>
                        <div style="font-size: 0.8em; display: grid; grid-template-columns: 1fr 1fr; gap: 5px 8px; line-height: 1.3;">
                            <div style="text-align: right; font-weight: bold;">Cloud layers Begin:</div>
                            <div>Altitude 1km (3,280 ft)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Cloud layers End:</div>
                            <div>Altitude 12km (40,000 ft)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Average Ocean Depth:</div>
                            <div>4km (13,120 ft)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Mount Everest:</div>
                            <div>8.8km (29,000 ft)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Troposphere (Oxygen):</div>
                            <div>Ends ~10 miles from Earth's Surface</div>
                            
                            <div style="text-align: right; font-weight: bold;">Japan:</div>
                            <div>1900 km (1180.6 mi) long</div>
                            
                            <div style="text-align: right; font-weight: bold;">Australia:</div>
                            <div>4000 km (2485.5 mi) wide, 3700 km (2299 mi) tall</div>
                            
                            <div style="text-align: right; font-weight: bold;">New York City:</div>
                            <div>470 square miles</div>
                            
                            <div style="grid-column: 1 / -1; margin-top: 10px; font-style: italic; text-align: center; color: #666;">
                                Australia is comparable to the Continental US and Europe
                            </div>
                        </div>
                    </div>
                    
                    <!-- Celestial Section -->
                    <div class="reference-section" style="flex: 0 1 auto; min-width: 300px; max-width: 400px;">
                        <h4 style="color: var(--primary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 5px;">Celestial</h4>
                        <div style="font-size: 0.8em; display: grid; grid-template-columns: 1fr 1fr; gap: 5px 8px; line-height: 1.3;">
                            <div style="text-align: right; font-weight: bold;">Diameter of the Moon:</div>
                            <div>3475 km (2160 mi)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Mass of the Moon:</div>
                            <div>7.35e22 kg (8.1e19 tons)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Diameter of the Earth:</div>
                            <div>12750 km (7922.5 mi)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Mass of the Earth:</div>
                            <div>5.97e24 kg (6.58e21 tons)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Diameter of the Sun:</div>
                            <div>1.39e6 km (8.64e5 mi)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Mass of the Sun:</div>
                            <div>1.989e30 kg (2.19e27 tons)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Diameter of Solar System:</div>
                            <div>1.2e10 km (7.456e9 mi)</div>
                            
                            <div style="text-align: right; font-weight: bold;">Diameter of The Milky Way:</div>
                            <div>9.46e17 km (5.878e17 mi)</div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <div style="text-align: center; font-size: 0.7em; color: #999; margin-top: 20px; padding: 10px;">
        2025 by newmar42 (Nov 2025) - v3.x by AbsentStar (Oct.08.2007) - v2.1 by Byl (Dec 2000)
        <br>
        <a href="gts-converter.html" style="color: #007bff; font-size: 0.9em; text-decoration: none;">old version</a>
    </div>

<script>
    // ========================================
    // CONSTANTS AND CONFIGURATION
    // ========================================
    
    // Visual rendering constants
    const BUILDING_REAL_HEIGHT_FEET = 200;
    const BUILDING_REAL_HEIGHT_INCHES = BUILDING_REAL_HEIGHT_FEET * 12; // 2400 inches
    
    // Unit conversion constants
    const INCHES_TO_CM = 2.54;
    const LBS_TO_KG = 0.453592;
    const FEET_TO_METERS = 0.3048;
    
    // Application state
    let currentOutputUnit = 'standard';  // Tracks current display unit preference
    let currentRange = 'gts';            // Tracks current size range selection
    
    // Range presets for slider controls
    const RANGES = {
        mini: { min: 7.5, max: 25, default: 15 },
        gts: { min: 20, max: 200, default: 50 },
        mega: { min: 200, max: 2500, default: 500 },
        giga: { min: 500, max: 528000, default: 5000 }
    };
    
    // ========================================
    // UTILITY FUNCTIONS
    // ========================================
    
    /**
     * Adds comma separators to large numbers for readability
     * @param {string|number} nStr - Number to format
     * @returns {string} Formatted number with commas
     */
    function addCommas(nStr) {
        nStr += '';
        var x = nStr.split('.');
        var x1 = x[0];
        var x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + ',' + '$2');
        }
        return x1 + x2;
    }
    
    // Pre-load images to prevent display delays
    const femaleImg = new Image();
    femaleImg.src = 'female-silouette-strong.png';
    const buildingImg = new Image();
    buildingImg.src = '200ft-tall-bldg.png';

    // ========================================
    // INPUT/OUTPUT SYNCHRONIZATION FUNCTIONS
    // ========================================
    
    /**
     * Updates metric inputs and outputs when standard inputs change
     * This is the main orchestrator function called when any standard input changes
     */
    function updateFromStandard() {
        // Read standard inputs
        const wmnfeet = parseFloat(document.getElementById('wmnfeet').value) || 0;
        const wmninches = parseFloat(document.getElementById('wmninches').value) || 0;
        const wmnweight = parseFloat(document.getElementById('wmnweight').value) || 0;
        const cup = parseFloat(document.getElementById('cup').value) || 2.35;
        const shoe = parseFloat(document.getElementById('shoe').value) || 9.69;
        const key1 = parseFloat(document.getElementById('key1').value) || 36;
        const key2 = parseFloat(document.getElementById('key2').value) || 24;
        const key3 = parseFloat(document.getElementById('key3').value) || 36;
        const gtslift = parseFloat(document.getElementById('gtslift').value) || 50;
        const gtsmiles = parseFloat(document.getElementById('gtsmiles').value) || 0;
        const gtsfeet = parseFloat(document.getElementById('gtsfeet').value) || 0;
        const gtsinches = parseFloat(document.getElementById('gtsinches').value) || 0;

        // Convert to metric and update metric inputs
        const totalInches = (wmnfeet * 12) + wmninches;
        const totalCm = totalInches * INCHES_TO_CM;
        // Only use meters field when >= 10m (1000cm)
        if (totalCm >= 1000) {
            document.getElementById('wmnmeters').value = Math.floor(totalCm / 100).toFixed(2);
            document.getElementById('wmncm').value = Math.floor(totalCm % 100);
        } else {
            document.getElementById('wmnmeters').value = 0;
            document.getElementById('wmncm').value = Math.floor(totalCm);
        }
        
        document.getElementById('wmnkg').value = (wmnweight * LBS_TO_KG).toFixed(1);
        document.getElementById('cupMetric').value = cup;
        document.getElementById('shoeMetric').value = shoe;
        document.getElementById('key1Metric').value = (key1 * INCHES_TO_CM).toFixed(1);
        document.getElementById('key2Metric').value = (key2 * INCHES_TO_CM).toFixed(1);
        document.getElementById('key3Metric').value = (key3 * INCHES_TO_CM).toFixed(1);
        document.getElementById('gtsliftMetric').value = (gtslift * LBS_TO_KG).toFixed(1);

        // Target size - match behavior of before size (only use meters above 1000cm)
        const targetInches = (gtsmiles * 63360) + (gtsfeet * 12) + gtsinches;
        const targetCm = targetInches * INCHES_TO_CM;
        
        if (targetCm >= 100000) {
            // Above 100000cm = 1km: use km field
            document.getElementById('gtskm').value = Math.floor(targetCm / 100000);
            const remainingCm = targetCm % 100000;
            document.getElementById('gtsmeters').value = Math.floor(remainingCm / 100);
            document.getElementById('gtscm').value = Math.floor(remainingCm % 100);
        } else if (targetCm >= 1000) {
            // Above 1000cm (10m): use m field
            document.getElementById('gtskm').value = 0;
            document.getElementById('gtsmeters').value = Math.floor(targetCm / 100);
            document.getElementById('gtscm').value = Math.floor(targetCm % 100);
        } else {
            // Below 1000cm: all in cm field
            document.getElementById('gtskm').value = 0;
            document.getElementById('gtsmeters').value = 0;
            document.getElementById('gtscm').value = Math.floor(targetCm);
        }

        // Update metric slider to match
        const heightSliderMetric = document.getElementById('heightSliderMetric');
        if (heightSliderMetric) {
            const targetMeters = targetCm / 100;
            heightSliderMetric.value = targetMeters.toFixed(2);
        }

        // Update outputs
        updateOutputsFromStandard(currentOutputUnit);
    }

    /**
     * Updates standard inputs and outputs when metric inputs change
     * Converts metric values back to standard units and triggers recalculation
     */
    function updateFromMetric() {
        // Read metric inputs
        const wmnmeters = parseFloat(document.getElementById('wmnmeters').value) || 0;
        const wmncm = parseFloat(document.getElementById('wmncm').value) || 0;
        const wmnkg = parseFloat(document.getElementById('wmnkg').value) || 0;
        const cupMetric = parseFloat(document.getElementById('cupMetric').value) || 2.35;
        const shoeMetric = parseFloat(document.getElementById('shoeMetric').value) || 9.69;
        const key1Metric = parseFloat(document.getElementById('key1Metric').value) || 91;
        const key2Metric = parseFloat(document.getElementById('key2Metric').value) || 61;
        const key3Metric = parseFloat(document.getElementById('key3Metric').value) || 91;
        const gtsliftMetric = parseFloat(document.getElementById('gtsliftMetric').value) || 23;
        const gtskm = parseFloat(document.getElementById('gtskm').value) || 0;
        const gtsmeters = parseFloat(document.getElementById('gtsmeters').value) || 0;
        const gtscm = parseFloat(document.getElementById('gtscm').value) || 0;

        // Convert to standard and update standard inputs
        const totalCm = (wmnmeters * 100) + wmncm;
        const totalInches = totalCm / INCHES_TO_CM;
        document.getElementById('wmnfeet').value = Math.floor(totalInches / 12);
        document.getElementById('wmninches').value = Math.floor(totalInches % 12);
        
        document.getElementById('wmnweight').value = Math.round(wmnkg / LBS_TO_KG);
        document.getElementById('cup').value = cupMetric;
        document.getElementById('shoe').value = shoeMetric;
        document.getElementById('key1').value = Math.round(key1Metric / INCHES_TO_CM);
        document.getElementById('key2').value = Math.round(key2Metric / INCHES_TO_CM);
        document.getElementById('key3').value = Math.round(key3Metric / INCHES_TO_CM);
        document.getElementById('gtslift').value = Math.round(gtsliftMetric / LBS_TO_KG);

        // Target size
        const targetCm = (gtskm * 100000) + (gtsmeters * 100) + gtscm;
        const targetInches = targetCm / INCHES_TO_CM;
        const targetFeet = targetInches / 12;
        if (targetFeet >= 5280) {
            document.getElementById('gtsmiles').value = Math.floor(targetFeet / 5280);
            document.getElementById('gtsfeet').value = Math.floor(targetFeet % 5280);
        } else {
            document.getElementById('gtsmiles').value = 0;
            document.getElementById('gtsfeet').value = Math.floor(targetFeet);
        }
        document.getElementById('gtsinches').value = Math.floor(targetInches % 12);

        // Update standard slider to match
        const heightSlider = document.getElementById('heightSlider');
        if (heightSlider) {
            heightSlider.value = targetFeet.toFixed(1);
        }

        // Update outputs
        updateOutputsFromStandard(currentOutputUnit);
    }

    // ========================================
    // CORE CALCULATION AND RENDERING PIPELINE
    // ========================================
    
    /**
     * Main calculation and rendering pipeline - processes all inputs and updates UI
     * @param {string} outputUnit - Display unit preference ('standard' or 'metric')
     */
    function updateOutputsFromStandard(outputUnit = 'standard') {
        // 1. Get Inputs (from standard)
        const wmnfeet = parseFloat(document.getElementById('wmnfeet').value) || 0;
        const wmninches = parseFloat(document.getElementById('wmninches').value) || 0;
        const wmnweight = parseFloat(document.getElementById('wmnweight').value) || 0;
        const cup = parseFloat(document.getElementById('cup').value) || 2.35;
        const shoe = parseFloat(document.getElementById('shoe').value) || 9.69;
        const key1 = parseFloat(document.getElementById('key1').value) || 36;
        const key2 = parseFloat(document.getElementById('key2').value) || 24;
        const key3 = parseFloat(document.getElementById('key3').value) || 36;
        const gtslift = parseFloat(document.getElementById('gtslift').value) || 50;

        const gtsmiles = parseFloat(document.getElementById('gtsmiles').value) || 0;
        const gtsfeet = parseFloat(document.getElementById('gtsfeet').value) || 0;
        const gtsinches = parseFloat(document.getElementById('gtsinches').value) || 0;

        // 2. Calculate Factors
        const startHeightInches = (wmnfeet * 12) + wmninches;
        const targetHeightInches = (gtsmiles * 63360) + (gtsfeet * 12) + gtsinches;
        
        if (startHeightInches <= 0 || targetHeightInches <= 0) return;

        const factor = targetHeightInches / startHeightInches;
        const factor68 = startHeightInches / 68; // Normalized to 5'8"
        const factor120 = wmnweight / 120; // Normalized to 120lbs

        // Helper Functions
        const findmi = (inches) => Math.floor(inches / 63360);
        const findft = (inches) => Math.floor((inches / 12) % 5280);
        const findin = (inches) => Math.floor(inches % 12);
        const find1din = (inches) => Math.floor((inches % 12) * 10) / 10;
        const findtons = (lbs) => Math.floor(lbs / 2000);
        const findpounds = (lbs) => Math.floor(lbs % 2000);

        try {
            // 3. Update Visuals
            updateVisuals(startHeightInches, targetHeightInches);
            console.log('Visuals updated successfully');

            // 4. Update Key Stats
            // Helper for metric formatting (same as in populateMeasurementsGrid)
            const formatMetricValue = (inches) => {
                const cm = inches * 2.54;
                if (cm >= 100000) { // 1km
                    return (Math.floor(cm / 100000 * 100) / 100) + " km";
                } else if (cm >= 1000) { // 10m - only show meters above this
                    return (Math.floor(cm / 100 * 100) / 100) + " m";
                } else {
                    return (Math.floor(cm * 10) / 10) + " cm";
                }
            };

            const formatWeightMetric = (lbs) => {
                const kg = lbs * LBS_TO_KG;
                if (kg >= 1000000) {
                    return (Math.floor(kg / 1000000 * 100) / 100) + " million kg";
                } else if (kg >= 1000) {
                    return (Math.floor(kg / 1000 * 100) / 100) + " tonnes";
                } else {
                    return Math.floor(kg) + " kg";
                }
            };

            // 5. Calculate ALL measurements (pure calculation function)
            const allCalcs = calculateAllMeasurements(factor, factor68, factor120, startHeightInches, targetHeightInches, cup, shoe, key1, key2, key3, gtslift, wmnweight);
            
            // Debug removed
            
            // 6. Use new rendering functions that read from JSON
            renderMeasurementsFromJSON(allCalcs, outputUnit);
        } catch (error) {
            console.error('Error in update function:', error);
        }
    }

    // ========================================
    // FORMATTING UTILITY FUNCTIONS
    // ========================================
    
    /**
     * Formats height measurements for display in imperial units
     * @param {number} inches - Height in inches to format
     * @returns {string} Formatted height string
     */
    function formatHeight(inches) {
        if (inches >= 63360) {
            const mi = Math.floor(inches / 63360);
            const ft = Math.floor((inches / 12) % 5280);
            return `${mi} mi, ${ft} ft`;
        } else if (inches >= 12) {
            const ft = Math.floor(inches / 12);
            const inc = Math.floor(inches % 12);
            return `${ft} ft, ${inc} in`;
        } else {
            return `${inches.toFixed(1)} in`;
        }
    }

    /**
     * Formats weight measurements for display in imperial units
     * @param {number} lbs - Weight in pounds to format
     * @returns {string} Formatted weight string
     */
    function formatWeight(lbs) {
        if (lbs >= 2000) {
            const tons = Math.floor(lbs / 2000);
            const remLbs = Math.floor(lbs % 2000);
            return `${addCommas(tons)} tons, ${remLbs} lbs`;
        }
        return `${addCommas(Math.floor(lbs))} lbs`;
    }

    // ========================================
    // VISUAL RENDERING SYSTEM
    // ========================================
    
    /**
     * Updates the visual comparison display with scaled images and ruler
     * @param {number} startInches - Starting height in inches for scale reference
     * @param {number} targetInches - Target giantess height in inches
     */
    function updateVisuals(startInches, targetInches) {
        // Visual Constants - match .visual-container height (700px)
        const topY = 20;
        const groundY = 700; // Match container height
        const maxVisualHeight = groundY - topY; // 680px

        // 1. Giantess (Fixed visual height)
        const giantessWoman = document.getElementById('giantessWoman');
        const giantessHeight = maxVisualHeight;
        giantessWoman.style.height = giantessHeight + 'px';
        giantessWoman.style.left = '160px';
        giantessWoman.style.transform = '';

        // 2. Starting Person (Proportional, right-aligned within anchor div)
        const startPerson = document.getElementById('startPerson');
        const scaleRatio = startInches / targetInches;
        const startHeight = maxVisualHeight * scaleRatio;
        startPerson.style.height = startHeight + 'px';
        // Right edge stays fixed at anchor position due to right: 0 positioning within anchor div

        // 3. Building (200ft = 2400 inches, proportional scale)
        const buildingRef = document.getElementById('buildingRef');
        const buildingScaleRatio = BUILDING_REAL_HEIGHT_INCHES / targetInches;
        const buildingHeight = maxVisualHeight * buildingScaleRatio;
        buildingRef.style.height = buildingHeight + 'px';
        // Left edge positioned to the right of giantess
        buildingRef.style.left = '420px';
        
        // 3. Ruler (Dynamic Values)
        const rulerGroup = document.getElementById('rulerGroup');
        rulerGroup.innerHTML = `<line x1="75" y1="${topY}" x2="75" y2="${groundY}" stroke="black" stroke-width="2" />`;
        
        // Choose appropriate tick interval based on current unit mode
        let intervalInches;
        
        if (currentOutputUnit === 'metric') {
            // For metric mode: use nice round metric intervals
            const targetCm = targetInches * INCHES_TO_CM;
            let intervalCm = 10; // Start with 10cm
            
            // Nice metric intervals: 10cm, 20cm, 50cm, 100cm, 2m, 5m, 10m, 20m, 50m, 100m, 1km, 10km, 100km
            const niceIntervals = [10, 20, 50, 100, 200, 500, 1000, 2000, 5000, 10000, 20000, 50000, 100000, 1000000, 5000000, 10000000];
            
            for (let i = 0; i < niceIntervals.length; i++) {
                intervalCm = niceIntervals[i];
                if ((targetCm / intervalCm) <= 12) break;
            }
            
            // Convert to inches for positioning
            intervalInches = intervalCm / INCHES_TO_CM;
        } else {
            // For standard mode: doubling pattern (1ft, 2ft, 4ft, 8ft, etc.)
            intervalInches = 12; // Start with 1 foot
            while ((targetInches / intervalInches) > 12) {
                intervalInches *= 2;
            }
        }
        
        // Generate ticks
        for (let currentInches = 0; currentInches <= targetInches; currentInches += intervalInches) {
            const visualY = groundY - ( (currentInches / targetInches) * maxVisualHeight );
            
            // Tick Line
            const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
            line.setAttribute("x1", "70");
            line.setAttribute("y1", visualY);
            line.setAttribute("x2", "80");
            line.setAttribute("y2", visualY);
            line.setAttribute("stroke", "black");
            rulerGroup.appendChild(line);
            
            // Text Labels - skip for zero (bottom tick)
            if (currentInches > 0) {
                // Text Label - Standard units (left side)
                const textStandard = document.createElementNS("http://www.w3.org/2000/svg", "text");
                textStandard.setAttribute("x", "65");
                textStandard.setAttribute("y", visualY + 4);
                textStandard.setAttribute("text-anchor", "end");
                textStandard.setAttribute("font-size", "12");
                textStandard.textContent = formatHeightShortWithBothUnits(currentInches);
                rulerGroup.appendChild(textStandard);
                
                // Text Label - Metric units (right side)
                const textMetric = document.createElementNS("http://www.w3.org/2000/svg", "text");
                textMetric.setAttribute("x", "85");
                textMetric.setAttribute("y", visualY + 4);
                textMetric.setAttribute("text-anchor", "start");
                textMetric.setAttribute("font-size", "12");
                textMetric.textContent = formatHeightMetricShort(currentInches);
                rulerGroup.appendChild(textMetric);
            }
        }
    }

    /**
     * Formats height for compact ruler display (imperial)
     * @param {number} inches - Height in inches
     * @returns {string} Compact height format
     */
    function formatHeightShort(inches) {
        if (inches === 0) return "0";
        if (inches >= 63360) { // Miles
            return (inches / 63360).toFixed(2) + "mi";
        } else if (inches >= 12) { // Feet
            return Math.round(inches / 12) + "ft";
        } else {
            return Math.round(inches) + "in";
        }
    }

    /**
     * Formats height for ruler display with appropriate unit scaling
     * @param {number} inches - Height in inches
     * @returns {string} Height format optimized for ruler labels
     */
    function formatHeightShortWithBothUnits(inches) {
        if (inches === 0) return "0";
        if (inches >= 30000) { // 2500 feet (30000 inches) - show in miles with decimal
            const mi = inches / 63360; // 63360 inches = 1 mile
            return mi.toFixed(1) + "mi";
        } else if (inches >= 240) { // 20 feet - omit inches above this
            const ft = Math.floor(inches / 12);
            return ft + "ft";
        } else if (inches >= 12) { // Below 20 feet - show inches
            const ft = Math.floor(inches / 12);
            const inc = Math.floor(inches % 12);
            return inc > 0 ? `${ft}ft ${inc}in` : `${ft}ft`;
        } else {
            return Math.round(inches) + "in";
        }
    }

    /**
     * Formats height for compact ruler display (metric)
     * @param {number} inches - Height in inches
     * @returns {string} Compact metric height format
     */
    function formatHeightMetricShort(inches) {
        if (inches === 0) return "0";
        
        const cm = inches * INCHES_TO_CM;
        if (cm >= 100000) { // 1km+ - show with decimal for precision
            return (cm / 100000).toFixed(1) + "km";
        } else if (cm >= 1000) { // 10m+
            return Math.round(cm / 100) + "m";
        } else {
            return Math.round(cm) + "cm";
        }
    }

    // ========================================
    // CORE CALCULATION ENGINE
    // ========================================
    
    /**
     * Pure calculation function that computes all giantess measurements
     * This function has no side effects - it only calculates and returns data
     * @param {number} factor - Overall size scaling factor
     * @param {number} factor68 - Normalization factor based on 5'8" baseline
     * @param {number} factor120 - Weight normalization factor based on 120lbs baseline
     * @param {number} startHeightInches - Starting height in inches
     * @param {number} targetHeightInches - Target height in inches
     * @param {number} cup - Cup size factor
     * @param {number} shoe - Shoe size in inches
     * @param {number} key1 - Bust measurement in inches
     * @param {number} key2 - Waist measurement in inches
     * @param {number} key3 - Hip measurement in inches
     * @param {number} gtslift - Lifting capacity in pounds
     * @param {number} wmnweight - Starting weight in pounds
     * @returns {Object} Complete measurements object with unit-labeled properties
     */
    function calculateAllMeasurements(factor, factor68, factor120, startHeightInches, targetHeightInches, cup, shoe, key1, key2, key3, gtslift, wmnweight) {
        const headw = (startHeightInches / 7) * (2/3);
        const headh = startHeightInches / 7;
        const breast = cup;
        const cupcomp = (((cup + 1) / cup) - 0.1);
        const shoecomp = (((shoe * shoe / 8) - 8) / 250);
        
        // Energy calculations
        const stepJoules = (factor120 * 120 * Math.pow(factor, 3) * 0.4536) / 2 * (9.81) * (0.07 * factor);
        const stompJoules = (factor120 * 120 * Math.pow(factor, 3) * 0.4536) / 2 * (11.5) * (0.5 * factor);
        const jumpJoules = (factor120 * 120 * Math.pow(factor, 3) * 0.4536) * (9.81) * (0.43 * factor);
        
        return {
            overall: {
                heightInches: targetHeightInches,
                weightLbs: factor120 * 120 * Math.pow(factor, 3),
                shoulderWidthInches: headw * 2.9 * factor,
                hipWidthInches: headw * (2 + (key3/32 - 1) * 1.5) * factor,
                liftCapacityLbs: gtslift * Math.pow(factor, 3)
            },
            measurements: {
                bustInches: key1 * factor,
                waistInches: key2 * factor,
                hipsInches: key3 * factor
            },
            keyHeights: {
                ankleHeightInches: headh / 3 * factor,
                kneeHeightInches: headh * 1.875 * factor,
                crotchHeightInches: headh * 3.5 * factor,
                hipHeightInches: headh * 4 * factor,
                breastCuspHeightInches: ((headh * 5) - (((breast + cupcomp * 1.5) - 3.65)) * 0.8) * factor,
                nippleHeightInches: ((headh * 5) - (((breast + cupcomp * 1.5) - 3.65)) * 0.8) * factor + (breast + cupcomp) * 1.35 * factor,
                neckHeightInches: headh * 5.75 * factor,
                chinHeightInches: headh * 6 * factor
            },
            head: {
                hairDiameterInches: 0.002 * factor,
                mouthOpeningInches: factor68 * 2.2 * factor,
                smileWidthInches: factor68 * 2.6 * factor,
                tongueLengthInches: factor68 * 3.9 * factor,
                tongueStickOutInches: factor68 * 1.5 * factor
            },
            breasts: {
                heightInches: (breast + cupcomp) * 1.35 * factor,
                widthInches: (breast + cupcomp) * 1.15 * factor,
                depthInches: breast * factor,
                weightLbs: cup * Math.pow(factor, 3),
                areolaeDiameterInches: ((breast + cupcomp * 1.337) * factor) * cupcomp / 4.1,
                nippleDiameterInches: ((breast + cupcomp * 1.337) * factor) * cupcomp / 14.8,
                nippleErectLengthInches: ((breast + cupcomp * 1.337) * factor) * cupcomp / 8.2,
                milkDuctDiameterInches: factor * (0.019 + breast / 2000),
                milkDropGallons: (((4/3 * 3.14 * Math.pow((((breast + cupcomp * 1.337) * factor) * cupcomp / 355.2), 3)) * 3)),
                milkDropLbs: ((((4/3 * 3.14 * Math.pow((((breast + cupcomp * 1.337) * factor) * cupcomp / 355.2), 3)) * 3)) * 8.32)
            },
            crotch: {
                vaginaDepthInches: factor68 * 6 * factor,
                labiaHeightInches: factor68 * 1.75 * factor
            },
            armsLegs: {
                armLengthInches: factor68 * 22 * factor,
                palmWidthInches: startHeightInches / 9.2 * 0.525 * factor,
                fingerLengthInches: startHeightInches / 9.2 * 0.475 * factor,
                fingerThicknessInches: factor68 * 0.68 * factor,
                legLengthInches: headh * 3.5 * factor,
                footWidthInches: shoe * (0.334 + shoecomp) * factor,
                footLengthInches: shoe * factor
            },
            movement: {
                walkStrideInches: factor68 * 26.5 * factor,
                runStrideInches: factor68 * 66 * factor,
                walkSpeedMph: (factor68 * 26.5 * factor * 7200 / 63360),
                runSpeedMph: (factor68 * 66 * factor * 9600 / 63360)
            },
            energy: {
                stepJoules: stepJoules,
                stompJoules: stompJoules,
                jumpJoules: jumpJoules
            },
            reference: {
                manHeightToHerInches: 72 / factor,
                manWeightToHerLbs: 180 / Math.pow(factor, 3)
            }
        };
    }

    // ========== RENDERING FUNCTIONS ==========
    // These functions only read from the measurements JSON and render to HTML
    
    function renderMeasurementsFromJSON(measurements, outputUnit = 'standard') {
        // Main render orchestrator
        renderKeyStats(measurements, outputUnit);
        
        // Render all body part sections (accordion sections)
        renderAllBodyPartSections(measurements, outputUnit);
    }
    
    function renderAllBodyPartSections(measurements, outputUnit) {
        renderKeyHeightsSection(measurements, outputUnit);
        renderHeadSection(measurements, outputUnit);
        renderBreastsSection(measurements, outputUnit);
        renderMilkSection(measurements, outputUnit);
        renderCrotchSection(measurements, outputUnit);
        renderArmsLegsSection(measurements, outputUnit);
        renderMovementSection(measurements, outputUnit);
    }
    
    function renderKeyHeightsSection(measurements, outputUnit) {
        const container = document.getElementById('keyHeightsContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        const totalHeightValue = formatValue(measurements.overall.heightInches);
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Total Height:</div>
                <div style="font-weight: bold; color: var(--primary-color);">${totalHeightValue}</div>
                
                <div style="text-align: right; font-weight: bold;">Chin:</div>
                <div>${formatValue(measurements.keyHeights.chinHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Neck:</div>
                <div>${formatValue(measurements.keyHeights.neckHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Nipple:</div>
                <div>${formatValue(measurements.keyHeights.nippleHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Breast Cusp:</div>
                <div>${formatValue(measurements.keyHeights.breastCuspHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Hip:</div>
                <div>${formatValue(measurements.keyHeights.hipHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Crotch:</div>
                <div>${formatValue(measurements.keyHeights.crotchHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Knee:</div>
                <div>${formatValue(measurements.keyHeights.kneeHeightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Ankle:</div>
                <div>${formatValue(measurements.keyHeights.ankleHeightInches)}</div>
            </div>
        `;
    }
    
    function renderHeadSection(measurements, outputUnit) {
        const container = document.getElementById('headContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Hair diameter:</div>
                <div>${formatValue(measurements.head.hairDiameterInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Mouth opening:</div>
                <div>${formatValue(measurements.head.mouthOpeningInches)} tall</div>
                
                <div style="text-align: right; font-weight: bold;">Smile width:</div>
                <div>${formatValue(measurements.head.smileWidthInches)} wide</div>
                
                <div style="text-align: right; font-weight: bold;">Tongue length:</div>
                <div>${formatValue(measurements.head.tongueLengthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Tongue extension:</div>
                <div>${formatValue(measurements.head.tongueStickOutInches)}</div>
            </div>
        `;
    }
    
    function renderBreastsSection(measurements, outputUnit) {
        const container = document.getElementById('breastsContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        const formatWeight = (lbs) => outputUnit === 'metric' ? formatWeightMetric(lbs) : formatWeightImperial(lbs);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        const formatWeightMetric = (lbs) => {
            const kg = lbs * LBS_TO_KG;
            if (kg >= 1000) return (Math.floor(kg / 1000 * 100) / 100) + " tonnes";
            else return Math.floor(kg) + " kg";
        };
        
        const formatWeightImperial = (lbs) => {
            if (lbs >= 2000) {
                const tons = Math.floor(lbs / 2000);
                const remLbs = Math.floor(lbs % 2000);
                return `${addCommas(tons)} tons, ${remLbs} lbs`;
            }
            return `${addCommas(Math.floor(lbs))} lbs`;
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Height:</div>
                <div>${formatValue(measurements.breasts.heightInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Width:</div>
                <div>${formatValue(measurements.breasts.widthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Depth:</div>
                <div>${formatValue(measurements.breasts.depthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Weight each:</div>
                <div>${formatWeight(measurements.breasts.weightLbs)}</div>
                
                <div style="text-align: right; font-weight: bold;">Areola diameter:</div>
                <div>${formatValue(measurements.breasts.areolaeDiameterInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Nipple diameter:</div>
                <div>${formatValue(measurements.breasts.nippleDiameterInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Nipple erect:</div>
                <div>${formatValue(measurements.breasts.nippleErectLengthInches)}</div>
                
                <div style="text-align: right; font-style: italic; color: #666;">Height to breast cusp:</div>
                <div style="color: #666; font-style: italic;">${formatValue(measurements.keyHeights.breastCuspHeightInches)}</div>
            </div>
        `;
    }
    
    function renderMilkSection(measurements, outputUnit) {
        const container = document.getElementById('milkContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        const formatVolume = (gallons) => {
            if (outputUnit === 'metric') {
                const liters = gallons * 3.785;
                return addCommas(Math.floor(liters * 100) / 100) + " liters";
            } else {
                return addCommas(Math.floor(gallons * 100) / 100) + " gallons";
            }
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Stream diameter:</div>
                <div>${formatValue(measurements.breasts.milkDuctDiameterInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Drop volume:</div>
                <div>${formatVolume(measurements.breasts.milkDropGallons)}</div>
                
                <div style="text-align: right; font-weight: bold;">Drop weight:</div>
                <div>${Math.floor(measurements.breasts.milkDropLbs)} lbs</div>
            </div>
        `;
    }
    
    /**
     * Renders the Crotch measurements accordion section
     * @param {Object} measurements - Complete measurements object
     * @param {string} outputUnit - Display unit preference
     */
    function renderCrotchSection(measurements, outputUnit) {
        const container = document.getElementById('crotchContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Vagina depth:</div>
                <div>${formatValue(measurements.crotch.vaginaDepthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Labia height:</div>
                <div>${formatValue(measurements.crotch.labiaHeightInches)}</div>
                
                <div style="text-align: right; font-style: italic; color: #666;">Height to crotch:</div>
                <div style="color: #666; font-style: italic;">${formatValue(measurements.keyHeights.crotchHeightInches)}</div>
            </div>
        `;
    }
    
    /**
     * Renders the Arms & Legs measurements accordion section
     * @param {Object} measurements - Complete measurements object
     * @param {string} outputUnit - Display unit preference
     */
    function renderArmsLegsSection(measurements, outputUnit) {
        const container = document.getElementById('armsLegsContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Arm length:</div>
                <div>${formatValue(measurements.armsLegs.armLengthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Palm width:</div>
                <div>${formatValue(measurements.armsLegs.palmWidthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Finger length:</div>
                <div>${formatValue(measurements.armsLegs.fingerLengthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Finger thickness:</div>
                <div>${formatValue(measurements.armsLegs.fingerThicknessInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Leg length:</div>
                <div>${formatValue(measurements.armsLegs.legLengthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Foot width:</div>
                <div>${formatValue(measurements.armsLegs.footWidthInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Foot length:</div>
                <div>${formatValue(measurements.armsLegs.footLengthInches)}</div>
            </div>
        `;
    }
    
    /**
     * Renders the Movement measurements accordion section (includes energy calculations)
     * @param {Object} measurements - Complete measurements object
     * @param {string} outputUnit - Display unit preference
     */
    function renderMovementSection(measurements, outputUnit) {
        const container = document.getElementById('movementContent');
        const formatValue = (inches) => outputUnit === 'metric' ? formatMetricValue(inches) : formatHeight(inches);
        const formatSpeed = (mph) => outputUnit === 'metric' ? (mph * 1.60934).toFixed(1) + " km/h" : mph.toFixed(1) + " mph";
        
        const formatMetricValue = (inches) => {
            const cm = inches * INCHES_TO_CM;
            if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
            else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
            else return (Math.floor(cm * 10) / 10) + " cm";
        };
        
        const formatEnergy = (joules) => {
            if (joules >= 1e12) return (joules / 1e12).toFixed(1) + "T J";
            else if (joules >= 1e9) return (joules / 1e9).toFixed(1) + "B J";
            else if (joules >= 1e6) return (joules / 1e6).toFixed(1) + "M J";
            else if (joules >= 1e3) return (joules / 1e3).toFixed(1) + "K J";
            else return joules.toFixed(0) + " J";
        };
        
        const calculateEarthquakeMagnitude = (joules) => {
            if (joules <= 0) return 0;
            const magnitude = (2/3) * Math.log10(joules) - 2.9;
            return Math.max(0, magnitude);
        };
        
        const formatEnergyWithEq = (joules) => {
            const energyStr = formatEnergy(joules);
            const magnitude = calculateEarthquakeMagnitude(joules);
            if (magnitude >= 0.1) {
                return energyStr + " (eq " + magnitude.toFixed(1) + ")";
            }
            return energyStr;
        };
        
        container.innerHTML = `
            <div style="font-size: 0.8em; display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 5px 8px; line-height: 1.3;">
                <div style="text-align: right; font-weight: bold;">Walking stride:</div>
                <div>${formatValue(measurements.movement.walkStrideInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Running stride:</div>
                <div>${formatValue(measurements.movement.runStrideInches)}</div>
                
                <div style="text-align: right; font-weight: bold;">Walking speed:</div>
                <div>${formatSpeed(measurements.movement.walkSpeedMph)}</div>
                
                <div style="text-align: right; font-weight: bold;">Running speed:</div>
                <div>${formatSpeed(measurements.movement.runSpeedMph)}</div>
                
                <div style="text-align: right; font-weight: bold;">Step energy:</div>
                <div>${formatEnergyWithEq(measurements.energy.stepJoules)}</div>
                
                <div style="text-align: right; font-weight: bold;">Stomp energy:</div>
                <div>${formatEnergyWithEq(measurements.energy.stompJoules)}</div>
                
                <div style="text-align: right; font-weight: bold;">Jump energy:</div>
                <div>${formatEnergyWithEq(measurements.energy.jumpJoules)}</div>
            </div>
        `;
    }
    
    /**
     * Renders the key statistics bar at the bottom of the page
     * @param {Object} measurements - Complete measurements object
     * @param {string} outputUnit - Display unit preference
     */
    function renderKeyStats(measurements, outputUnit) {
        // Helper functions for formatting
        const formatHeightDisplay = (inches) => {
            if (outputUnit === 'metric') {
                const cm = inches * INCHES_TO_CM;
                if (cm >= 100000) return (Math.floor(cm / 100000 * 100) / 100) + " km";
                else if (cm >= 1000) return (Math.floor(cm / 100 * 100) / 100) + " m";
                else return (Math.floor(cm * 10) / 10) + " cm";
            } else {
                return formatHeight(inches);
            }
        };
        
        const formatWeightDisplay = (lbs) => {
            if (outputUnit === 'metric') {
                const kg = lbs * LBS_TO_KG;
                if (kg >= 1000000) return (Math.floor(kg / 1000000 * 100) / 100) + " million kg";
                else if (kg >= 1000) return (Math.floor(kg / 1000 * 100) / 100) + " tonnes";
                else return Math.floor(kg) + " kg";
            } else {
                return formatWeight(lbs);
            }
        };
        
        // Total height now rendered in the keyHeights section
        
        // Render weight
        document.getElementById('resWeight').innerText = formatWeightDisplay(measurements.overall.weightLbs);
        
        // Render measurements (B/W/H)
        if (outputUnit === 'metric') {
            const bustCm = measurements.measurements.bustInches * INCHES_TO_CM;
            const waistCm = measurements.measurements.waistInches * INCHES_TO_CM;
            const hipCm = measurements.measurements.hipsInches * INCHES_TO_CM;
            
            const formatMeasurement = (cm) => {
                if (cm >= 100000) return (cm / 100000).toFixed(1);
                if (cm >= 1000) return (cm / 100).toFixed(1);
                return cm.toFixed(1);
            };
            
            const getUnitMeasurement = (cm) => {
                if (cm >= 100000) return 'km';
                if (cm >= 1000) return 'm';
                return 'cm';
            };
            
            const bust = formatMeasurement(bustCm);
            const waist = formatMeasurement(waistCm);
            const hip = formatMeasurement(hipCm);
            const unit = getUnitMeasurement(bustCm);
            
            document.getElementById('resMeasurements').innerText = `${bust} - ${waist} - ${hip} ${unit}`;
        } else {
            const formatSimple = (inches) => {
                if (inches >= 63360) return (inches / 63360).toFixed(1);
                else if (inches >= 72) return (inches / 12).toFixed(1);
                else return inches.toFixed(1);
            };
            
            const getUnit = (inches) => {
                if (inches >= 63360) return 'mi';
                if (inches >= 72) return 'ft';
                return 'in';
            };
            
            const bust = formatSimple(measurements.measurements.bustInches);
            const waist = formatSimple(measurements.measurements.waistInches);
            const hip = formatSimple(measurements.measurements.hipsInches);
            const unit = getUnit(measurements.measurements.bustInches);
            
            document.getElementById('resMeasurements').innerText = `${bust} - ${waist} - ${hip} ${unit}`;
        }
        
        // Render foot length
        document.getElementById('resFoot').innerText = formatHeightDisplay(measurements.armsLegs.footLengthInches);
        
        // Render speeds
        if (outputUnit === 'metric') {
            const walkSpeedKmh = Math.floor(measurements.movement.walkSpeedMph * 1.60934 * 10) / 10;
            const runSpeedKmh = Math.floor(measurements.movement.runSpeedMph * 1.60934 * 10) / 10;
            document.getElementById('resWalkSpeed').innerText = walkSpeedKmh + " km/h";
            document.getElementById('resRunSpeed').innerText = runSpeedKmh + " km/h";
        } else {
            document.getElementById('resWalkSpeed').innerText = measurements.movement.walkSpeedMph.toFixed(1) + " mph";
            document.getElementById('resRunSpeed').innerText = measurements.movement.runSpeedMph.toFixed(1) + " mph";
        }
    }
    
    // ========================================
    // USER INTERACTION HANDLERS
    // ========================================
    
    /**
     * Handles accordion section toggle - ensures only one section open at a time
     * @param {string} sectionName - Name of the section to toggle
     * @param {Element} headerElement - The header element that was clicked
     */
    function toggleAccordion(sectionName, headerElement) {
        const allHeaders = document.querySelectorAll('.accordion-header');
        const allContents = document.querySelectorAll('.accordion-content');
        const targetContent = document.getElementById(sectionName + '-content');
        
        // Close all sections
        allHeaders.forEach(header => header.classList.remove('active'));
        allContents.forEach(content => content.classList.remove('active'));
        
        // Open clicked section
        headerElement.classList.add('active');
        targetContent.classList.add('active');
    }

    /**
     * Switches between standard and metric output units for display
     * @param {string} unitType - Either 'standard' or 'metric'
     * @param {Element} buttonElement - The button that was clicked
     */
    function switchOutputUnit(unitType, buttonElement) {
        // Update current output unit
        currentOutputUnit = unitType;
        
        // Update button states in the measurements tabs
        const buttons = buttonElement.parentElement.querySelectorAll('.tab');
        buttons.forEach(btn => btn.classList.remove('active'));
        buttonElement.classList.add('active');
        
        // Re-populate the measurements grid with the new unit
        updateOutputsFromStandard(unitType);
    }

    /**
     * Switches between standard and metric input forms
     * @param {string} unitType - Either 'standard' or 'metric'
     * @param {Element} buttonElement - The button that was clicked
     */
    function switchInputUnit(unitType, buttonElement) {
        // Update current output unit to match input unit
        currentOutputUnit = unitType;
        
        // Update button states
        const buttons = buttonElement.parentElement.querySelectorAll('.range-btn');
        buttons.forEach(btn => btn.classList.remove('active'));
        buttonElement.classList.add('active');
        
        // Update content visibility
        document.getElementById('standard-inputs').classList.remove('active');
        document.getElementById('metric-inputs').classList.remove('active');
        document.getElementById(unitType + '-inputs').classList.add('active');
        
        // Re-render outputs with the new unit
        updateOutputsFromStandard(unitType);
    }

    function setRangeMetric(rangeType, buttonElement) {
        currentRange = rangeType;
        
        // Update BOTH sliders
        const RANGES_METRIC = {
            mini: { min: 2.286, max: 7.62, default: 5 },        // 500cm = 5m
            gts: { min: 6.096, max: 60.96, default: 15 },       // 15m
            mega: { min: 60.96, max: 762, default: 150 },       // 150m
            giga: { min: 152.4, max: 160934.4, default: 1500000 } // 1500km = 1,500,000m
        };
        const rangeMetric = RANGES_METRIC[rangeType];
        const sliderMetric = document.getElementById('heightSliderMetric');
        sliderMetric.min = rangeMetric.min;
        sliderMetric.max = rangeMetric.max;
        sliderMetric.value = rangeMetric.default;
        
        const range = RANGES[rangeType];
        const slider = document.getElementById('heightSlider');
        slider.min = range.min;
        slider.max = range.max;
        slider.value = range.default;
        
        // Sync button states on BOTH sides
        const metricButtons = document.querySelector('#metric-inputs .range-buttons');
        if (metricButtons) {
            metricButtons.querySelectorAll('.range-btn').forEach(btn => btn.classList.remove('active'));
        }
        if (buttonElement) {
            buttonElement.classList.add('active');
        }
        
        const standardButtons = document.querySelector('#standard-inputs .range-buttons');
        if (standardButtons) {
            const standardBtns = standardButtons.querySelectorAll('.range-btn');
            standardBtns.forEach(btn => btn.classList.remove('active'));
            standardBtns.forEach(btn => {
                if (btn.textContent.trim() === buttonElement.textContent.trim()) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Update standard target size inputs (this is the source of truth)
        const feet = parseFloat(slider.value);
        if (feet >= 5280) {
            document.getElementById('gtsmiles').value = Math.floor(feet / 5280);
            document.getElementById('gtsfeet').value = Math.floor(feet % 5280);
        } else {
            document.getElementById('gtsmiles').value = 0;
            document.getElementById('gtsfeet').value = Math.floor(feet);
        }
        document.getElementById('gtsinches').value = 0;
        
        // This will sync metric inputs and recalc everything
        updateFromStandard();
    }

    // ========================================
    // EVENT LISTENERS SETUP
    // ========================================
    
    // Event Listeners - Standard inputs
    const standardInputIds = ['wmnfeet', 'wmninches', 'wmnweight', 'cup', 'shoe', 'key1', 'key2', 'key3', 'gtslift', 'gtsmiles', 'gtsfeet', 'gtsinches'];
    standardInputIds.forEach(id => {
        const elem = document.getElementById(id);
        if (elem) {
            elem.addEventListener('input', updateFromStandard);
            elem.addEventListener('change', updateFromStandard);
        }
    });

    // Event Listeners - Metric inputs
    const metricInputIds = ['wmnmeters', 'wmncm', 'wmnkg', 'cupMetric', 'shoeMetric', 'key1Metric', 'key2Metric', 'key3Metric', 'gtsliftMetric', 'gtskm', 'gtsmeters', 'gtscm'];
    metricInputIds.forEach(id => {
        const elem = document.getElementById(id);
        if (elem) {
            elem.addEventListener('input', updateFromMetric);
            elem.addEventListener('change', updateFromMetric);
        }
    });

    // Range presets moved to top of file in constants section

    function setRange(rangeType, buttonElement) {
        currentRange = rangeType;
        const range = RANGES[rangeType];
        
        // Update BOTH sliders
        const slider = document.getElementById('heightSlider');
        slider.min = range.min;
        slider.max = range.max;
        slider.value = range.default;
        
        const sliderMetric = document.getElementById('heightSliderMetric');
        const RANGES_METRIC = {
            mini: { min: 2.286, max: 7.62, default: 5 },        // 500cm = 5m
            gts: { min: 6.096, max: 60.96, default: 15 },       // 15m
            mega: { min: 60.96, max: 762, default: 150 },       // 150m
            giga: { min: 152.4, max: 160934.4, default: 1500000 } // 1500km = 1,500,000m
        };
        const rangeMetric = RANGES_METRIC[rangeType];
        sliderMetric.min = rangeMetric.min;
        sliderMetric.max = rangeMetric.max;
        sliderMetric.value = rangeMetric.default;
        
        // Sync button states on BOTH sides
        const standardButtons = document.querySelector('#standard-inputs .range-buttons');
        if (standardButtons) {
            standardButtons.querySelectorAll('.range-btn').forEach(btn => btn.classList.remove('active'));
        }
        if (buttonElement) {
            buttonElement.classList.add('active');
        }
        
        const metricButtons = document.querySelector('#metric-inputs .range-buttons');
        if (metricButtons) {
            const metricBtns = metricButtons.querySelectorAll('.range-btn');
            metricBtns.forEach(btn => btn.classList.remove('active'));
            metricBtns.forEach(btn => {
                if (btn.textContent.trim() === buttonElement.textContent.trim()) {
                    btn.classList.add('active');
                }
            });
        }
        
        // Update standard target size inputs
        const feet = parseFloat(slider.value);
        if (feet >= 5280) {
            document.getElementById('gtsmiles').value = Math.floor(feet / 5280);
            document.getElementById('gtsfeet').value = Math.floor(feet % 5280);
        } else {
            document.getElementById('gtsmiles').value = 0;
            document.getElementById('gtsfeet').value = Math.floor(feet);
        }
        document.getElementById('gtsinches').value = 0;
        
        // This will sync metric inputs and recalc everything
        updateFromStandard();
    }

    // Slider Logic
    const slider = document.getElementById('heightSlider');
    slider.addEventListener('input', (e) => {
        const val = parseFloat(e.target.value);
        // Update target size based on value
        if (val >= 5280) {
            document.getElementById('gtsmiles').value = Math.floor(val / 5280);
            document.getElementById('gtsfeet').value = Math.floor(val % 5280);
        } else {
            document.getElementById('gtsmiles').value = 0;
            document.getElementById('gtsfeet').value = Math.floor(val);
        }
        updateFromStandard();
    });

    // Slider Logic for Metric
    const sliderMetric = document.getElementById('heightSliderMetric');
    sliderMetric.addEventListener('input', (e) => {
        const meters = parseFloat(e.target.value);
        const totalCm = meters * 100;
        
        // Use same subdivision logic as before size
        if (totalCm >= 100000) {
            // Above 100000cm = 1km
            document.getElementById('gtskm').value = Math.floor(totalCm / 100000);
            const remainingCm = totalCm % 100000;
            document.getElementById('gtsmeters').value = Math.floor(remainingCm / 100);
            document.getElementById('gtscm').value = Math.floor(remainingCm % 100);
        } else if (totalCm >= 1000) {
            // Above 1000cm (10m): use m field
            document.getElementById('gtskm').value = 0;
            document.getElementById('gtsmeters').value = Math.floor(totalCm / 100);
            document.getElementById('gtscm').value = Math.floor(totalCm % 100);
        } else {
            // Below 1000cm: all in cm field
            document.getElementById('gtskm').value = 0;
            document.getElementById('gtsmeters').value = 0;
            document.getElementById('gtscm').value = Math.floor(totalCm);
        }
        updateFromMetric();
    });

    // ========================================
    // INITIALIZATION
    // ========================================
    
    // Initial calculation and rendering call
    updateFromStandard();

</script>
</body>
</html>